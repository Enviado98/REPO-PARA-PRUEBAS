<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Captura de Logs</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Courier New', monospace;
    background: #0d1117;
    color: #e6edf3;
    min-height: 100vh;
    padding: 16px;
  }
  h1 {
    font-size: 16px;
    color: #58a6ff;
    margin-bottom: 4px;
    letter-spacing: 1px;
    text-transform: uppercase;
  }
  p.sub {
    font-size: 11px;
    color: #8b949e;
    margin-bottom: 12px;
  }
  .url-bar {
    display: flex;
    gap: 8px;
    margin-bottom: 12px;
  }
  .url-bar input {
    flex: 1;
    background: #161b22;
    border: 1px solid #30363d;
    color: #e6edf3;
    padding: 8px 10px;
    border-radius: 6px;
    font-size: 13px;
    font-family: 'Courier New', monospace;
  }
  .url-bar input:focus { outline: none; border-color: #58a6ff; }
  button {
    background: #238636;
    color: #fff;
    border: none;
    border-radius: 6px;
    padding: 8px 14px;
    font-size: 13px;
    cursor: pointer;
    white-space: nowrap;
  }
  button:active { background: #2ea043; }
  button.secondary {
    background: #21262d;
    border: 1px solid #30363d;
  }
  button.copy-btn {
    background: #1f6feb;
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    font-size: 14px;
    font-weight: bold;
  }
  #log-box {
    background: #161b22;
    border: 1px solid #30363d;
    border-radius: 6px;
    padding: 10px;
    min-height: 200px;
    max-height: 55vh;
    overflow-y: auto;
    font-size: 12px;
    line-height: 1.6;
    word-break: break-all;
  }
  .log-line { padding: 2px 0; border-bottom: 1px solid #21262d; }
  .log-line.warn { color: #d29922; }
  .log-line.error { color: #f85149; }
  .log-line.info { color: #3fb950; }
  .log-line.log { color: #e6edf3; }
  .badge {
    display: inline-block;
    font-size: 10px;
    padding: 1px 5px;
    border-radius: 3px;
    margin-right: 4px;
    font-weight: bold;
  }
  .badge.warn { background: #d29922; color: #000; }
  .badge.error { background: #f85149; color: #fff; }
  .badge.info { background: #3fb950; color: #000; }
  .badge.log { background: #8b949e; color: #000; }
  #status {
    font-size: 11px;
    color: #8b949e;
    margin-bottom: 6px;
  }
  .copied { background: #238636 !important; }
  iframe { display: none; }
</style>
</head>
<body>

<h1>ğŸ” Captura de Logs</h1>
<p class="sub">Abre tu web aquÃ­ abajo para capturar todos los console.log</p>

<div class="url-bar">
  <input type="url" id="url-input" placeholder="https://tu-web.onrender.com" />
  <button onclick="loadSite()">Abrir</button>
  <button class="secondary" onclick="clearLogs()">ğŸ—‘</button>
</div>

<div id="status">Esperando... introduce tu URL y pulsa Abrir</div>
<div id="log-box"><span style="color:#8b949e">Los logs aparecerÃ¡n aquÃ­...</span></div>
<button class="copy-btn" onclick="copyLogs()">ğŸ“‹ Copiar todos los logs</button>

<iframe id="frame"></iframe>

<script>
  const logs = [];

  function ts() {
    const d = new Date();
    return `[${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}:${d.getSeconds().toString().padStart(2,'0')}]`;
  }

  function addLog(type, msg) {
    const entry = `${ts()} [${type.toUpperCase()}] ${msg}`;
    logs.push(entry);
    const box = document.getElementById('log-box');
    // Clear placeholder
    if (logs.length === 1) box.innerHTML = '';
    const line = document.createElement('div');
    line.className = `log-line ${type}`;
    line.innerHTML = `<span class="badge ${type}">${type.toUpperCase()}</span>${escHtml(msg)}`;
    box.appendChild(line);
    box.scrollTop = box.scrollHeight;
    document.getElementById('status').textContent = `${logs.length} mensajes capturados`;
  }

  function escHtml(s) {
    return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  // Intercept our own console too
  ['log','warn','error','info'].forEach(type => {
    const orig = console[type].bind(console);
    console[type] = (...args) => {
      orig(...args);
      addLog(type, args.map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' '));
    };
  });

  // Listen for messages from iframe (postMessage bridge)
  window.addEventListener('message', (e) => {
    if (e.data && e.data.type === 'console') {
      addLog(e.data.level || 'log', e.data.msg);
    }
  });

  function loadSite() {
    const url = document.getElementById('url-input').value.trim();
    if (!url) { alert('Introduce la URL de tu web'); return; }

    clearLogs();
    document.getElementById('status').textContent = 'Intentando cargar...';

    // Method 1: try iframe (may be blocked by X-Frame-Options)
    const frame = document.getElementById('frame');
    frame.src = url;
    frame.onload = () => {
      addLog('info', `âœ… Iframe cargado: ${url}`);
      addLog('info', 'NOTA: Si no aparecen logs de tu web, usa el mÃ©todo manual abajo â†“');
    };
    frame.onerror = () => {
      addLog('error', `âŒ No se pudo cargar en iframe: ${url}`);
      addLog('info', 'Usa el mÃ©todo manual: abre tu web, pega el script de inyecciÃ³n en la URL');
    };

    // Show injection script instructions
    addLog('info', 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    addLog('info', 'MÃ‰TODO MANUAL (100% seguro):');
    addLog('info', '1. Abre tu web en otra pestaÃ±a');
    addLog('info', '2. Copia el bookmarklet de abajo');
    addLog('info', '3. PÃ©galo en la barra de URL de tu web y pulsa Enter');
    addLog('info', 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
  }

  function clearLogs() {
    logs.length = 0;
    document.getElementById('log-box').innerHTML = '<span style="color:#8b949e">Los logs aparecerÃ¡n aquÃ­...</span>';
    document.getElementById('status').textContent = 'Logs limpiados';
  }

  function copyLogs() {
    if (logs.length === 0) { alert('No hay logs todavÃ­a'); return; }
    const text = logs.join('\n');
    navigator.clipboard.writeText(text).then(() => {
      const btn = document.querySelector('.copy-btn');
      btn.textContent = 'âœ… Â¡Copiado!';
      btn.classList.add('copied');
      setTimeout(() => {
        btn.textContent = 'ğŸ“‹ Copiar todos los logs';
        btn.classList.remove('copied');
      }, 2000);
    }).catch(() => {
      // Fallback
      const ta = document.createElement('textarea');
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand('copy');
      document.body.removeChild(ta);
      alert('Â¡Copiado!');
    });
  }
</script>

<!-- BOOKMARKLET SECTION -->
<div style="margin-top:16px; background:#161b22; border:1px solid #30363d; border-radius:6px; padding:12px;">
  <div style="font-size:12px; color:#58a6ff; margin-bottom:6px; font-weight:bold;">ğŸ“Œ MÃ‰TODO MANUAL â€” Bookmarklet</div>
  <div style="font-size:11px; color:#8b949e; margin-bottom:8px;">
    Abre tu web, copia TODO el texto de abajo, pÃ©galo en la barra de URL y pulsa Enter. Los logs aparecerÃ¡n en un cuadro flotante en tu web.
  </div>
  <textarea id="bookmarklet" readonly style="
    width:100%; height:80px; background:#0d1117; color:#3fb950;
    border:1px solid #30363d; border-radius:4px; padding:8px;
    font-family:'Courier New',monospace; font-size:10px;
    resize:none; word-break:break-all;
  ">javascript:(function(){var logs=[];var orig={log:console.log,warn:console.warn,error:console.error,info:console.info};['log','warn','error','info'].forEach(function(t){console[t]=function(){orig[t].apply(console,arguments);var msg=Array.from(arguments).map(function(a){return typeof a==='object'?JSON.stringify(a):String(a);}).join(' ');logs.push('['+t.toUpperCase()+'] '+msg);if(box)box.innerHTML=logs.map(function(l){return'<div style="border-bottom:1px solid #333;padding:2px 0">'+l+'</div>';}).join('');};});var box=document.createElement('div');box.style.cssText='position:fixed;bottom:0;left:0;right:0;height:40vh;background:#0d1117;color:#e6edf3;font-family:monospace;font-size:11px;overflow-y:auto;z-index:99999;padding:8px;border-top:2px solid #58a6ff;';var hdr=document.createElement('div');hdr.style.cssText='display:flex;justify-content:space-between;margin-bottom:6px;';hdr.innerHTML='<b style="color:#58a6ff">ğŸ” LOGS EN VIVO</b><span><button onclick="navigator.clipboard.writeText('+JSON.stringify('placeholder')+');this.textContent=\'âœ… Copiado\'" style="background:#1f6feb;color:#fff;border:none;padding:4px 8px;border-radius:4px;cursor:pointer;margin-right:4px">ğŸ“‹ Copiar</button><button onclick="this.closest(\'div[style*=fixed]\').remove()" style="background:#f85149;color:#fff;border:none;padding:4px 8px;border-radius:4px;cursor:pointer">âœ•</button></span>';box.appendChild(hdr);document.body.appendChild(box);box.querySelector('button[onclick*=clipboard]').onclick=function(){navigator.clipboard.writeText(logs.join('\n')).then(function(){alert('Â¡Copiado! '+ logs.length+' logs');});};console.log('ğŸ” Captura de logs activa');})();</textarea>
  <button onclick="copyBookmarklet()" style="width:100%;margin-top:8px;background:#1f6feb;">ğŸ“‹ Copiar Bookmarklet</button>
</div>

<script>
function copyBookmarklet() {
  const ta = document.getElementById('bookmarklet');
  navigator.clipboard.writeText(ta.value).then(() => {
    alert('âœ… Bookmarklet copiado. Ahora:\n1. Abre tu web\n2. Toca la barra de URL\n3. Borra todo y pega esto\n4. Pulsa Enter');
  }).catch(() => {
    ta.select();
    document.execCommand('copy');
    alert('âœ… Copiado');
  });
}
</script>

</body>
</html>

